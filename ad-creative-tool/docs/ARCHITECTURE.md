# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (Next.js)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              React Components (App Router)            â”‚  â”‚
â”‚  â”‚  â€¢ ProjectWizard                                      â”‚  â”‚
â”‚  â”‚  â€¢ Step1Input â†’ Step2Extraction â†’ Step3Analysis      â”‚  â”‚
â”‚  â”‚  â€¢ Step4Copywriting â†’ Step5BannerGeneration          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“ API Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (Next.js API Routes)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /api/scrape          - Playwright ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°    â”‚  â”‚
â”‚  â”‚  /api/analyze/colors  - Gemini ã‚«ãƒ©ãƒ¼æŠ½å‡º           â”‚  â”‚
â”‚  â”‚  /api/analyze/marketing - Gemini ãƒãƒ¼ã‚±åˆ†æ         â”‚  â”‚
â”‚  â”‚  /api/generate/copies - Claude ã‚³ãƒ”ãƒ¼ç”Ÿæˆ           â”‚  â”‚
â”‚  â”‚  /api/generate/background - Imagen èƒŒæ™¯ç”Ÿæˆ         â”‚  â”‚
â”‚  â”‚  /api/generate/banner - Vercel OG ãƒ†ã‚­ã‚¹ãƒˆåˆæˆ      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚              â”‚              â”‚
            â†“              â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Playwrightâ”‚   â”‚  AI APIs  â”‚   â”‚  Vercel  â”‚
    â”‚  Browser  â”‚   â”‚  â€¢ Gemini â”‚   â”‚   Blob   â”‚
    â”‚ Automationâ”‚   â”‚  â€¢ Claude â”‚   â”‚ Storage  â”‚
    â”‚           â”‚   â”‚  â€¢ Imagen â”‚   â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

```
User Input (URL)
    â†“
Playwright Browser Launch
    â†“
Page Navigation & Screenshot
    â†“
Extract: Images, Text, Meta
    â†“
Upload Screenshot to Vercel Blob
    â†“
Return: {screenshot, images, textContent}
```

### 2. ã‚«ãƒ©ãƒ¼åˆ†æãƒ•ãƒ­ãƒ¼

```
Screenshot URL
    â†“
Fetch Image Data
    â†“
Convert to Base64
    â†“
Gemini Vision API
    â†“
Parse JSON Response
    â†“
Return: {main, accent, base} colors
```

### 3. ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°åˆ†æãƒ•ãƒ­ãƒ¼

```
Site Data (title, description, text)
    â†“
Construct Prompt
    â†“
Gemini Text API
    â†“
Parse Structured JSON
    â†“
Return: {competitors, strengths, target, brandTone}
```

### 4. ã‚³ãƒ”ãƒ¼ç”Ÿæˆãƒ•ãƒ­ãƒ¼

```
Analysis Data + Options
    â†“
Construct Creative Prompt
    â†“
Claude API (temperature: 0.8)
    â†“
Extract Numbered List
    â†“
Return: [copy1, copy2, ..., copy20]
```

### 5. ãƒãƒŠãƒ¼ç”Ÿæˆãƒ•ãƒ­ãƒ¼

```
Background Generation:
  Category + Tone + Size
      â†“
  Imagen API
      â†“
  Upload to Vercel Blob
      â†“
  Return Background URL

Text Composition:
  Background URL + Copy + Color
      â†“
  @vercel/og (Edge Runtime)
      â†“
  Render with Noto Sans JP
      â†“
  Return Final Banner (PNG)
```

## ğŸ—ï¸ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

### Frontend Components

```
components/
â”œâ”€â”€ ProjectWizard.tsx           # ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ç®¡ç†
â”œâ”€â”€ ProgressSteps.tsx           # ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
â””â”€â”€ steps/
    â”œâ”€â”€ Step1Input.tsx          # URLå…¥åŠ›ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³
    â”œâ”€â”€ Step2Extraction.tsx     # ã‚«ãƒ©ãƒ¼ãƒ»ç”»åƒé¸æŠ
    â”œâ”€â”€ Step3Analysis.tsx       # åˆ†æãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
    â”œâ”€â”€ Step4Copywriting.tsx    # ã‚³ãƒ”ãƒ¼é¸æŠ
    â””â”€â”€ Step5BannerGeneration.tsx # ãƒãƒŠãƒ¼ç”Ÿæˆãƒ»DL
```

### Backend Modules

```
lib/
â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ gemini.ts              # Gemini APIçµ±åˆ
â”‚   â”‚   â€¢ extractColors()
â”‚   â”‚   â€¢ analyzeMarketing()
â”‚   â”‚   â€¢ generateBackground()
â”‚   â””â”€â”€ claude.ts              # Claude APIçµ±åˆ
â”‚       â€¢ generateCopies()
â”‚       â€¢ refineCopy()
â”œâ”€â”€ scraper/
â”‚   â””â”€â”€ playwright-scraper.ts  # Playwrightçµ±åˆ
â”‚       â€¢ WebsiteScraper class
â”‚       â€¢ scrape()
â”‚       â€¢ extractImages()
â”‚       â€¢ extractText()
â””â”€â”€ config.ts                  # è¨­å®šç®¡ç†
```

### Type Definitions

```
types/
â””â”€â”€ project.ts
    â€¢ ProjectState
    â€¢ ColorPalette
    â€¢ AnalysisResult
    â€¢ Banner
    â€¢ API Response Types
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### API Key Management

```
Environment Variables (Vercel)
    â†“
Server-Side Only Access
    â†“
Never Exposed to Client
```

### Data Privacy

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹ã€æ°¸ç¶šåŒ–ãªã—
- **ç”Ÿæˆç”»åƒ**: Vercel Blobï¼ˆpublic accessï¼‰
- **ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿**: ä¸€æ™‚çš„ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¾Œç ´æ£„

### Rate Limiting

ç¾åœ¨æœªå®Ÿè£…ã€‚ä»Šå¾Œã®å®Ÿè£…æ¡ˆï¼š

```typescript
// lib/rate-limiter.ts
import { Redis } from '@upstash/redis';

export async function checkRateLimit(
  identifier: string,
  limit: number = 10,
  window: number = 60
): Promise<boolean> {
  // Implementation with Redis
}
```

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. API ãƒ¬ã‚¹ãƒãƒ³ã‚¹

| API | Target | Strategy |
|-----|--------|----------|
| Scraping | <10s | Playwright optimization |
| Color Analysis | <5s | Gemini Flash model |
| Marketing Analysis | <8s | Prompt optimization |
| Copy Generation | <12s | Batched generation |
| Background Gen | <15s | Parallel processing |
| Banner Composition | <2s | Edge runtime |

### 2. Frontend Optimization

- **Code Splitting**: Dynamic imports for steps
- **Image Optimization**: Next.js Image component
- **Lazy Loading**: Components loaded on demand
- **Memoization**: React.memo for heavy components

### 3. Caching Strategy

```typescript
// Future implementation
interface CacheStrategy {
  scraping: 'none';           // æ¯å›æ–°è¦å–å¾—
  colorAnalysis: '1 hour';    // åŒã˜URLã¯1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  marketing: '1 hour';        // åŒã˜ã‚µã‚¤ãƒˆã¯1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  copies: 'none';             // æ¯å›æ–°è¦ç”Ÿæˆ
  backgrounds: 'permanent';   // Blob storage
}
```

## ğŸ“Š ç›£è¦–ã¨ãƒ­ã‚°

### ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«

```typescript
enum LogLevel {
  ERROR = 'error',   // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚
  WARN = 'warn',     // è­¦å‘Šï¼ˆãƒªãƒˆãƒ©ã‚¤å¯èƒ½ï¼‰
  INFO = 'info',     // é€šå¸¸å‹•ä½œ
  DEBUG = 'debug'    // é–‹ç™ºæ™‚è©³ç´°
}
```

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ï¼ˆæ¨å¥¨ï¼‰

```
Vercel Analytics:
- Page Views
- Unique Visitors
- Core Web Vitals

Custom Metrics:
- API Response Times
- AI Generation Success Rate
- Banner Download Count
```

## ğŸ”§ é–‹ç™ºç’°å¢ƒ

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
npm run dev          # localhost:3000

# å‹ãƒã‚§ãƒƒã‚¯
npm run type-check   # TypeScript

# ãƒ“ãƒ«ãƒ‰
npm run build        # Production build
```

### ç’°å¢ƒå¤‰æ•°

```env
# Development (.env.local)
GOOGLE_AI_API_KEY=...
ANTHROPIC_API_KEY=...
NEXT_PUBLIC_DEMO_MODE=true

# Production (Vercel)
GOOGLE_AI_API_KEY=...
ANTHROPIC_API_KEY=...
BLOB_READ_WRITE_TOKEN=auto
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ï¼ˆä»Šå¾Œã®å®Ÿè£…ï¼‰

### Unit Tests

```typescript
// lib/ai/__tests__/gemini.test.ts
describe('extractColors', () => {
  it('should extract valid hex colors', async () => {
    const colors = await extractColors(mockImageUrl);
    expect(colors.main).toMatch(/^#[0-9A-F]{6}$/i);
  });
});
```

### Integration Tests

```typescript
// app/api/__tests__/scrape.test.ts
describe('POST /api/scrape', () => {
  it('should return scraped data', async () => {
    const response = await fetch('/api/scrape', {
      method: 'POST',
      body: JSON.stringify({ url: 'https://example.com' })
    });
    expect(response.status).toBe(200);
  });
});
```

### E2E Tests

```typescript
// e2e/banner-generation.spec.ts
test('complete banner generation flow', async ({ page }) => {
  await page.goto('/');
  await page.fill('input[name="url"]', 'https://example.com');
  await page.click('button[type="submit"]');
  // ... test all steps
});
```

## ğŸ“ˆ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

### ç¾åœ¨ã®åˆ¶é™

- **Vercel Serverless**: 10ç§’ï¼ˆHobbyï¼‰/ 60ç§’ï¼ˆProï¼‰
- **Concurrent Requests**: ãƒ—ãƒ©ãƒ³ã«ã‚ˆã‚‹
- **Blob Storage**: ç„¡åˆ¶é™ï¼ˆå¾“é‡èª²é‡‘ï¼‰

### ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æˆ¦ç•¥

1. **Queue System**: é•·æ™‚é–“å‡¦ç†ã‚’ã‚­ãƒ¥ãƒ¼ã«
2. **CDN**: ç”Ÿæˆç”»åƒã®ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
3. **Database**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ°¸ç¶šåŒ–
4. **Microservices**: å„AIå‡¦ç†ã‚’åˆ†é›¢

## ğŸ”„ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```yaml
# .github/workflows/ci.yml (æ¨å¥¨)
name: CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: npm run type-check
      - run: npm run lint
      - run: npm run build
```

## ğŸ“ ä»Šå¾Œã®æ”¹å–„æ¡ˆ

1. **State Management**: Zustand/Jotaiå°å…¥
2. **Real-time Updates**: WebSocket for progress
3. **Batch Processing**: è¤‡æ•°URLã®ä¸€æ‹¬å‡¦ç†
4. **Analytics Dashboard**: ä½¿ç”¨çµ±è¨ˆã®å¯è¦–åŒ–
5. **A/B Testing**: ãƒãƒŠãƒ¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆæ¸¬

---

è©³ç´°ãªå®Ÿè£…ã«ã¤ã„ã¦ã¯å„ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
